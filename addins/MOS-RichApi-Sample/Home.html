<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Expires" content="0" />
    <title>MetaOS App</title>
    <script src="https://appsforoffice.edog.officeapps.live.com/lib/beta/hosted/office.debug.js" type="text/javascript"></script>

    <script src="helper.js" type="text/javascript"></script>
    <script src="Home.js" type="text/javascript"></script>

    <script type="text/javascript">
        var g_hostInfo = {};
        var g_sharedAppData = {};
        var g_BgAppVisibilityState = {};

        function setSpanText(elementId, value) {
            var txt = document.createTextNode(value);
            var span = document.getElementById(elementId);
            if (span.hasChildNodes()) {
                span.removeChild(span.childNodes[0]);
            }
            span.appendChild(txt);
        }

        function appCmdUpdateSharedAppData(event) {
            g_sharedAppData.value = 2019;
            event.completed();
        }

        function BtnReadData() {
            setSpanText("SpanData", g_sharedAppData.value);
        }

        function BtnSetData() {
            var value = document.getElementById("TxtData").value;
            if (!value) {
                value = 2019;
            }

            g_sharedAppData.value = value;
        }

        function BtnShowInfoBar() {
            let key = 'RichAPI';

            Office.context.mailbox.item.notificationMessages.addAsync
            (
                key,

                {
                    type : Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
                    persistent: false,
                    message : "This is an informational infobar generated by " + key,
                    icon : "foo"
                },

                {
                    asyncContext: "random context 3000"
                },

                function (asyncResult)
                {
                    showMessage(JSON.stringify(asyncResult));
                }
            );
        }

        function BtnShow() {
            SetRuntimeVisibleHelper(true);
        }

        function BtnHide() {
            SetRuntimeVisibleHelper(false);
        }

        function BtnGetRuntimeState() {
            // _getState() is the internal API and it's only for Microsoft engineer team internal testing purpose. Please do not use it.
            return Office.addin._getState()
                .then(function (value) {
                    setSpanText("SpanGetRuntimeState", value);
                    return value;
                })
                .catch(function (error) {
                    return error.code;
                });
        }

        function BtnSetStartupBehaviorLoad() {
            SetStartupBehaviorHelper(Office.StartupBehavior.load);
        }

        function BtnSetStartupBehaviorNone() {
            SetStartupBehaviorHelper(Office.StartupBehavior.none);
        }

        function BtnGetStartupBehavior() {
            return Office.addin.getStartupBehavior()
                .then(function (value) {
                    setSpanText("SpanGetStartupBehavior", value);
                    return value;
                })
                .catch(function (error) {
                    return error.code;
                });
        }

        function BtnRun() {
            var code = document.getElementById("TxtCode").value;
            eval(code);
        }

        // App Commands
        function appCmdSetStateVisible(event) {
            SetRuntimeVisibleHelper(true);
            event.completed();
        }

        function appCmdSetStateBackground(event) {
            SetRuntimeVisibleHelper(false);
            event.completed();
        }

        function log(value) {
            var now = new Date();
            var time = '[' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds() + '] ';
            var txt = document.createTextNode(time + value);
            var div = document.createElement('div');
            div.appendChild(txt);
            document.getElementById('DivLog').appendChild(div);
        }

        Office.onReady(function (info) {
            g_hostInfo = info;
        });

    </script>
</head>
<body>
    <div>MetaOS App</div>
    <div>
        Data
        <div>
            <button id="BtnSetData" onclick="BtnSetData()">SetData</button>: <input id="TxtData" type="text" />
        </div>
        <div>
            <button id="BtnReadData" onclick="BtnReadData()">ReadData</button>: <span id="SpanData"></span>
        </div>
    </div>
    <div>
        InfoBar
        <div>
            <button id="BtnInfoBar" onclick="BtnShowInfoBar()">ShowInfoBar</button>
        </div>
    </div>
    <div>
        Visibility
        <div>
            <button id="BtnSetRuntimeStateShow" onclick="BtnShow()">Show</button>
            <button id="BtnSetRuntimeStateHide" onclick="BtnHide()">Hide</button>
        </div>
        <div>
            <button id="BtnGetRuntimeState" onclick="BtnGetRuntimeState()">GetRuntimeState</button>: <span id="SpanGetRuntimeState"></span>
        </div>
    </div>
    <div>
        Startup Behavior
        <div>
            <button id="BtnSetStartupBehaviorLoad" onclick="BtnSetStartupBehaviorLoad()">SetStartupBehaviorLoad</button>
            <button id="BtnSetStartupBehaviorNone" onclick="BtnSetStartupBehaviorNone()">SetStartupBehaviorNone</button>
        </div>
        <div>
            <button id="BtnGetStartupBehavior" onclick="BtnGetStartupBehavior()">GetStartupBehavior</button>: <span id="SpanGetStartupBehavior"></span>
        </div>
    </div>
    <div>
        <div>
            <button id="BtnRun" onclick="BtnRun()">Run</button> the following code:
        </div>
        <div>
            <textarea id="TxtCode" cols="40" rows="20" spellcheck="false"></textarea>
        </div>
    </div>
    <div>Logs:</div>
    <div id="DivLog">
    </div>
    <div>
        <span id="InitialDisplayMode"></span>
    </div>
</body>
</html>

